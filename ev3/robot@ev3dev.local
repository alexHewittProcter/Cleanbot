from socketIO_client import SocketIO
import ev3dev.ev3 as ev3
import time

frontLeftMotor = ev3.LargeMotor('outC')
frontRightMotor = ev3.LargeMotor('outB')
backLeftMotor = ev3.LargeMotor('outD')
backRightMotor = ev3.LargeMotor('outA')

ir = ev3.InfraredSensor()
# assert ir.connected, "Connect a single infrared sensor to any sensor port"

ir.mode = 'IR-PROX'

ev3.Sound.set_volume(100)
print("WORKING")
socket = SocketIO('http://bd9c8794.ngrok.io')
print("LINE 15")

def onConnect():
    print('Connected to Cloud, Dude', socket.transport_name)

def moveAround():
    print("Move around")
    running = True
    turning = False

    while(running) {
        moveForward()
        distance = ir.value()

        if(distance <= 35) {
            turning = True
            while(turning) {
                moveLeft()
                turnDistance = ir.value()
                if(turnDistance >= 70) {
                    turning = False
                }
            }
        }
    }


def moveCommand(command):
    print("Command move " + command)
    if(command == 'forward'):
        moveForward()
    elif(command == 'backward'):
        moveBackward()
    elif(command == 'left'):
        moveLeft()
    elif(command == 'right'):
        moveRight()
    else:
        stopMoving()

def moveMotor(motor,direction):
    if(motor == 'frontLeft'):
        if(direction == 'forward'):
            frontLeftMotor.run_forever(speed_sp=500)
        elif(direction == 'backward'):
            frontLeftMotor.run_forever(speed_sp=-500)
    elif(motor == 'frontRight'):
        if(direction == 'forward'):
            frontRightMotor.run_forever(speed_sp=500)
        elif(direction == 'backward'):
            frontRightMotor.run_forever(speed_sp=-500)
    elif(motor == 'backLeft'):
        if(direction == 'forward'):
            backLeftMotor.run_forever(speed_sp=-500)
        elif(direction == 'backward'):
            backLeftMotor.run_forever(speed_sp=500)
    elif(motor == 'backRight'):
        if(direction == 'forward'):
            backRightMotor.run_forever(speed_sp=-500)
        elif(direction == 'backward'):
            backRightMotor.run_forever(speed_sp=500)

def moveForward():
    moveMotor('frontLeft','forward')
    moveMotor('frontRight','forward')
    moveMotor('backLeft','forward')
    moveMotor('backRight','forward')

def moveBackward():
    moveMotor('frontLeft','backward')
    moveMotor('frontRight','backward')
    moveMotor('backLeft','backward')
    moveMotor('backRight','backward')

def moveLeft():
    moveMotor('frontLeft','backward')
    moveMotor('frontRight','forward')
    moveMotor('backLeft','backward')
    moveMotor('backRight','forward')


def moveRight():
    moveMotor('frontLeft','forward')
    moveMotor('frontRight','backward')
    moveMotor('backLeft','forward')
    moveMotor('backRight','backward')

def stopMoving():
    frontLeftMotor.stop()
    frontRightMotor.stop()
    backLeftMotor.stop()
    backRightMotor.stop()

moveForward()

socket.on('connect',onConnect)
socket.on('move',moveCommand)

socket.wait()
